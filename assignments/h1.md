# Tehtävä h1
[Tehtävänanto (Tero Karvinen)](http://terokarvinen.com/2018/aikataulu-%E2%80%93-palvelinten-hallinta-ict4tn022-4-ti-5-ke-5-loppukevat-2018-5p#h1)

## Alku

Omat Linux-taitoni eivät ole koskaan olleet lähinnä aloittelijan tasoa korkeammat. Ennen tätä kurssia en myöskään ollut hetkeen koskenut Linuxiin, ja ennen kurssin ensimmäistä tuntia oma Saltin lähtötasoni on nolla. En koe, että ymmärtäisin Saltin perusteita vielä ensimmäisen tunnin jälkeen. En ole löytänyt ohjetta, joka vääntäisi asiat rautalangasta vaiheittain: lähtöasetelma, asenna master ja minion, konfiguroi nämä tiedostot, luo nämä kansiot jne. Ohjeista tuntuu puuttuvan käytännönläheisyys, kaikki on hyvin abstraktia.

Aluksi luin läpi joitakin Saltin omia ohjeita: https://docs.saltstack.com/en/getstarted 
Silmäilin myös Jori Laineen Salt-dokumentaatiota: https://github.com/joonaleppalahti/CCM/tree/master/salt/srv/salt

SaltStackin materiaali vaikutti paljolti heprealta, mutta esimerkiksi "fundamentals" oli suht ymmärrettävissä. Laineen Salt-ohje osoittautui maanläheisemmäksi ja verraten hyödyllisemmäksi nyt, ja ehkä myös tulevan kannalta.

Kokeilin Saltia kotonani Mint 18.2 live usb-tikulla. En asentanut Linuxia toistaiseksi. Saltin master ja minion olivat siis yhdellä tietokoneella.

## Master ja minion -asennus

Lähdin asentamaan Salt-masteria Jori Laineen [ohjeen mukaisesti](https://github.com/joonaleppalahti/CCM/blob/master/salt/Installation%20instructions.md). Kopioin Curlin avulla Saltin asennusskriptin. Lippu -M tarkentaa, että asennetaan master. 
  
```
sudo curl -L https://bootstrap.saltstack.com -o install_salt.sh 
sudo sh install_salt.sh -P -M
...
 * ERROR: Failed to run install_ubuntu_stable_deps()!!!
```  
Ajettaessa skripti epäonnistui Saltin asentamisessa. Tämä johtunee siitä, etten asentanut Linuxia aiemmin. Saltin bootstrap tuntuu toistamiseen epäluotettavalta. Päätin asentaa Saltin kuten kurssin lähiopetustunnilla, eli paketinhallintaa käyttäen. Aloitin asentamalla masterin.

```
sudo apt install -y salt-master
```
Seuraavaksi muokkasin masterin asetuksia tiedostossa /etc/salt/master. Vaihdoin masterin osoitteen.

```
sudoedit /etc/salt/master

enable_gpu_grains: True
interface:127.0.0.1
```

Asensin salt-minionin samalla tavoin paketinhallinnan kautta. Muokkasin minionin asetuksia.

```
sudo apt install -y salt-minion
sudoedit /etc/salt/minion

master:127.0.0.1
```
Seuraavaksi paritin masterin ja minionin, hyväksymällä minionin avaimen. Käynnistin masterin ja minionin ensiksi uudelleen. Salt-key komennon -L-lippu näyttää eri avainten statukset, tässä tapauksessa hyväksymistä odottavan minionin avaimen. Kokennolla salt-key -A master hyväksyy avaimen.
```
sudo service salt-master restart
sudo service salt-minion restart
sudo salt-key -L
sudo salt-key -A
```

![saltkey](https://github.com/Oliver-Siren/palvelinten-hallinta-ict4tn022-4/blob/master/images/saltkey.png)


Loin juurihakemiston /srv/-kansioon /salt/-alakansion. Tähän kansioon luodaan myöhemmin Saltin käyttämät state-tiedostot.

```
cd /srv/
sudo mkdir /salt/
```

## Peruskomentojen testaaminen (Hello World?)

Palvelinten hallinta-kurssin ensimmäisellä tunnilla kokeiltiin aikaansaada Saltilla Hello World-ohjelma. Ajattelin replikoida tämän muistini virkistämiseksi. Ennen kuin aloin tuskailla edes perustason SLS-tiedostojen kanssa, testasin paria peruskomentoa. Minion vastasi onnistuneesti.

```
sudo salt '*' test.ping
```
![testping](https://github.com/Oliver-Siren/palvelinten-hallinta-ict4tn022-4/blob/master/images/testping.png)

Saltin komentojen jälkeen tulostuva file_ignore_glob-varoitus on kuuleman mukaan harmiton toistaiseksi, ja sen poistaminen vaatisi oman osaamiseni ja testiympäristön skaalan ylittävää konfigurointia.

Seuraavaksi Hello World... (state kokeiluja)

## grains
  
## minionin konfigurointi testimielessä
